<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>CrossRealm • On-Chain Checkers & Chess on Core</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        /* Bitcoin/Core Theme */
        :root {
            --bitcoin-orange: #f7931a; /* Primary */
            --core-green: #00ff88; /* Accents */
            --burnt-orange: #cc6600;
            --dark-bg: #0f0f0f;
            --card-bg: #1a1a1a;
            --border: #2a2a2a;
            --text: #e0e0e0;
            --text-dim: #999;
            --success: var(--core-green);
            --error: #ff4444;
            --gradient-primary: linear-gradient(135deg, var(--bitcoin-orange), var(--burnt-orange));
            --gradient-success: linear-gradient(135deg, var(--core-green), #00cc6a);
        }
        body { font-family: 'Courier New', monospace; background: var(--dark-bg); color: var(--text); padding: 0; margin: 0; }
        /* Mobile: Touch-friendly, responsive boards */
        @media (max-width: 768px) {
            .game-selector { flex-direction: column; gap: 0.5rem; }
            .game-board { max-width: 100vw; transform: rotate(0deg); } /* Portrait stack */
            .chess-board, .checkers-board { width: 90vw; height: 90vw; font-size: 2rem; } /* Scale */
            .chess-square, .checkers-square { min-height: 11.1vw; /* 10x10 */ }
        }
        @media (orientation: landscape) { .game-board { flex-direction: row; } }
        /* Rest of your CSS... (header, cards, buttons with new colors) */
        button { background: var(--gradient-primary); color: #000; }
        button:hover { box-shadow: 0 5px 15px var(--core-green); }
        .success { color: var(--core-green); }
    </style>
</head>
<body>
    <!-- Header with Game Selector (Stake-like bar) -->
    <div class="header">
        <div class="logo">⚡ CROSSREALM</div>
        <div class="game-selector">
            <button onclick="selectGame('checkers')" class="game-btn">⚫ Checkers</button>
            <button onclick="selectGame('chess')" class="game-btn">♟️ Chess</button>
            <select onchange="selectGame(this.value)">
                <option value="">More Games (Soon)</option>
                <option value="fighters">Fighters</option>
                <option value="racing">Racing</option>
            </select>
        </div>
        <!-- Wallet bar unchanged -->
    </div>
    
    <!-- Game Container (Responsive: Loads selected board) -->
    <div id="gameContainer" class="game-board hidden">
        <!-- Checkers Board (10x10, touch-drag) -->
        <div id="checkersBoard" class="checkers-board hidden" style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 1px; width: 400px; height: 400px; border: 2px solid var(--bitcoin-orange);">
            <!-- JS populates 100 squares -->
        </div>
        <!-- Chess Board (8x8, your original) -->
        <div id="chessBoard" class="chess-board hidden"><!-- unchanged --></div>
    </div>
    
    <!-- Create/Join Form (Multi-token select) -->
    <div class="card">
        <label>Stake Token:</label>
        <select id="stakeToken">
            <option value="CORE">CORE (Native)</option>
            <option value="WBTC">WBTC</option>
            <option value="USDT">USDT</option>
        </select>
        <input type="number" id="stakeAmount" placeholder="Stake (e.g., 0.01)" step="0.001">
        <button onclick="createGame()">Create Game</button>
    </div>
    
    <script>
        const HUB_ADDRESS = "0x..."; // Your deployed Hub
        const hub = new ethers.Contract(HUB_ADDRESS, HUB_ABI, provider); // Your ABI
        
        let currentGame = null;
        
        function selectGame(type) {
            document.querySelectorAll('.checkers-board, .chess-board').forEach(b => b.classList.add('hidden'));
            document.getElementById(type + 'Board').classList.remove('hidden');
            currentGame = type;
            initializeBoard(type); // Load rules/board
        }
        
        async function createGame() {
            const token = document.getElementById('stakeToken').value;
            const stake = ethers.parseEther(document.getElementById('stakeAmount').value);
            
            // Approve if ERC20
            if (token !== 'CORE') {
                const tokenContract = new ethers.Contract(tokenAddr[token], ERC20_ABI, signer);
                await tokenContract.approve(HUB_ADDRESS, stake);
            }
            
            const gameId = await hub.createGame(currentGame, stake, tokenAddr[token]); // Multi-token param
            console.log("Game ID:", gameId);
        }
        
        function initializeBoard(type) {
            if (type === 'checkers') {
                // 10x10 grid (touch events)
                const board = document.getElementById('checkersBoard');
                board.innerHTML = '';
                for (let i = 0; i < 100; i++) {
                    const sq = document.createElement('div');
                    sq.className = `checkers-square ${(Math.floor(i/10) + i%10) % 2 ? 'light' : 'dark'}`;
                    sq.dataset.pos = i;
                    sq.addEventListener('touchstart', handleTouchStart); // Mobile drag
                    sq.addEventListener('touchmove', handleTouchMove);
                    sq.addEventListener('touchend', handleTouchEnd);
                    board.appendChild(sq);
                }
                // Load initial pieces via getBoard call
            } else if (type === 'chess') {
                // Your original chess init
            }
        }
        
        // Touch handlers for mobile (drag pieces)
        let touchStartPos = null;
        function handleTouchStart(e) {
            touchStartPos = { x: e.touches[0].clientX, y: e.touches[0].clientY, pos: parseInt(e.target.dataset.pos) };
        }
        function handleTouchMove(e) { /* Visual drag preview */ }
        function handleTouchEnd(e) {
            if (touchStartPos) {
                const endPos = parseInt(e.changedTouches[0].target.dataset.pos || 0);
                // Validate & makeMove via hub
                hub.makeMove(gameId, touchStartPos.pos, endPos);
            }
            touchStartPos = null;
        }
        
        // Responsive resize
        window.addEventListener('resize', () => {
            const boards = document.querySelectorAll('.checkers-board, .chess-board');
            boards.forEach(b => {
                b.style.width = Math.min(window.innerWidth * 0.9, 400) + 'px';
                b.style.height = b.style.width;
            });
        });
    </script>
</body>
</html>
