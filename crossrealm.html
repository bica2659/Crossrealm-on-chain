<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossRealm ‚Ä¢ On-Chain Chess on Core</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bitcoin-orange: #f7931a;
            --burnt-orange: #cc6600;
            --dark-bg: #0f0f0f;
            --card-bg: #1a1a1a;
            --border: #2a2a2a;
            --text: #e0e0e0;
            --text-dim: #999;
            --success: #00c851;
            --error: #ff4444;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(247, 147, 26, 0.03) 2px, rgba(247, 147, 26, 0.03) 4px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            border: 2px solid var(--bitcoin-orange);
            border-radius: 0;
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(247, 147, 26, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: var(--bitcoin-orange);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
        }

        .tagline {
            color: var(--text-dim);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .wallet-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .wallet-status {
            font-size: 12px;
            color: var(--text-dim);
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
        }

        .wallet-address {
            color: var(--bitcoin-orange);
            font-weight: bold;
        }

        /* Buttons */
        button {
            background: linear-gradient(135deg, var(--bitcoin-orange), var(--burnt-orange));
            color: #000;
            border: none;
            padding: 12px 30px;
            font-family: inherit;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.3);
        }

        button:disabled {
            background: var(--border);
            color: var(--text-dim);
            cursor: not-allowed;
            opacity: 0.5;
        }

        button:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 400px 1fr 400px;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 25px;
        }

        .card-header {
            border-bottom: 2px solid var(--bitcoin-orange);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--bitcoin-orange);
        }

        /* Chess Board */
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0;
            max-width: 600px;
            margin: 0 auto;
            border: 3px solid var(--bitcoin-orange);
            aspect-ratio: 1;
        }

        .chess-square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .chess-square.light {
            background: #3a3a3a;
        }

        .chess-square.dark {
            background: #1a1a1a;
        }

        .chess-square:hover {
            background: rgba(247, 147, 26, 0.2);
        }

        .chess-square.selected {
            background: var(--burnt-orange);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .chess-square.valid-move {
            background: rgba(0, 200, 81, 0.3);
        }

        .chess-square.valid-move::after {
            content: '';
            position: absolute;
            width: 20%;
            height: 20%;
            background: var(--success);
            border-radius: 50%;
        }

        /* Game List */
        .game-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .game-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .game-item:hover {
            border-color: var(--bitcoin-orange);
            background: rgba(247, 147, 26, 0.1);
        }

        .game-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .game-id {
            color: var(--bitcoin-orange);
            font-weight: bold;
        }

        .game-stake {
            color: var(--text);
            font-size: 14px;
        }

        .game-player {
            color: var(--text-dim);
            font-size: 12px;
            margin-top: 5px;
        }

        /* Form Elements */
        input, select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: inherit;
            font-size: 14px;
            margin-top: 8px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--bitcoin-orange);
            background: rgba(247, 147, 26, 0.05);
        }

        label {
            color: var(--text);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        /* Alerts */
        .alert {
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
            background: rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            border-color: var(--success);
            color: var(--success);
        }

        .alert-error {
            border-color: var(--error);
            color: var(--error);
        }

        .alert-info {
            border-color: var(--bitcoin-orange);
            color: var(--bitcoin-orange);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bitcoin-orange);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--burnt-orange);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--bitcoin-orange);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 0;
            color: var(--text-dim);
            font-size: 12px;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        .footer-link {
            color: var(--bitcoin-orange);
            text-decoration: none;
            margin: 0 10px;
        }

        .footer-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">‚ö° CROSSREALM</div>
            <div class="tagline">On-Chain Chess ‚Ä¢ Powered by Bitcoin & Core</div>
            
            <div class="wallet-bar">
                <div class="wallet-status">
                    <span id="networkStatus">üî¥ Not Connected</span>
                    <span id="walletAddress" class="wallet-address"></span>
                </div>
                <button id="connectBtn" onclick="connectWallet()">
                    Connect Wallet
                </button>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alertArea"></div>

        <!-- Main Grid -->
        <div class="grid">
            <!-- Create Game -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚öîÔ∏è Create Game</div>
                </div>
                
                <div class="form-group">
                    <label>Stake Amount</label>
                    <input type="number" id="stakeAmount" placeholder="0.1 CORE" step="0.01" min="0.01" value="0.1">
                    <small style="color: var(--text-dim); font-size: 11px; display: block; margin-top: 5px;">
                        Min: 0.01 CORE ‚Ä¢ Max: 100 CORE
                    </small>
                </div>

                <button onclick="createGame()" id="createBtn" disabled style="width: 100%;">
                    Create Chess Game
                </button>
            </div>

            <!-- Chess Board -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">‚ôüÔ∏è Game Board</div>
                </div>
                
                <div id="chessBoardContainer">
                    <p style="text-align: center; color: var(--text-dim); padding: 40px;">
                        Create or join a game to play
                    </p>
                </div>
            </div>

            <!-- Available Games -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üéØ Available Games</div>
                </div>
                
                <button onclick="loadPendingGames()" style="width: 100%; margin-bottom: 15px;">
                    Refresh
                </button>
                
                <div class="game-list" id="gamesList">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- My Games -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">üìä My Games</div>
            </div>
            
            <button onclick="loadMyGames()" style="margin-bottom: 15px;">
                Refresh My Games
            </button>
            
            <div class="game-list" id="myGamesList">
                <p style="text-align: center; color: var(--text-dim);">
                    Connect wallet to see your games
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div>CrossRealm ¬© 2025 ‚Ä¢ Built on Core Blockchain</div>
            <div style="margin-top: 10px;">
                <a href="#" class="footer-link">Docs</a>
                <a href="#" class="footer-link">Twitter</a>
                <a href="#" class="footer-link">Discord</a>
            </div>
        </div>
    </div>

    <script>
        // ============ CONFIGURATION ============
        
        const CONTRACT_ADDRESS = 0x70Ea24005684b8811f97352faC9B7dd2f568b196;
        
        const CORE_TESTNET = {
            chainId: "0x45b",
            chainName: "Core Blockchain Testnet2",
            rpcUrls: ["https://rpc.test2.btcs.network"],
            blockExplorerUrls: ["https://scan.test2.btcs.network"],
            nativeCurrency: {
                name: "tCORE",
                symbol: "tCORE",
                decimals: 18
            }
        };

        const CONTRACT_ABI = [
            "function createGame() payable returns (uint256)",
            "function joinGame(uint256 gameId) payable",
            "function makeMove(uint256 gameId, uint8 from, uint8 to)",
            "function resign(uint256 gameId)",
            "function claimTimeout(uint256 gameId)",
            "function getGame(uint256 gameId) view returns (tuple(address player1, address player2, uint256 stake, address currentTurn, uint8[64] board, uint16 moveCount, uint256 lastMoveTime, address winner, uint8 status))",
            "function getBoard(uint256 gameId) view returns (uint8[64])",
            "function getPlayerGames(address player) view returns (uint256[])",
            "function getPendingGames(uint256 limit) view returns (uint256[])",
            "event GameCreated(uint256 indexed gameId, address indexed player1, uint256 stake)",
            "event MoveMade(uint256 indexed gameId, address indexed player, uint8 from, uint8 to)"
        ];

        // Chess piece unicode symbols
        const PIECE_SYMBOLS = {
            0: '',
            1: '‚ôô', 2: '‚ôò', 3: '‚ôó', 4: '‚ôñ', 5: '‚ôï', 6: '‚ôî',
            7: '‚ôü', 8: '‚ôû', 9: '‚ôù', 10: '‚ôú', 11: '‚ôõ', 12: '‚ôö'
        };

        // ============ STATE ============
        
        let provider, signer, contract, userAddress;
        let currentGameId = null;
        let selectedSquare = null;

        // ============ WALLET CONNECTION ============
        
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showAlert('Please install MetaMask or Core Wallet!', 'error');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: CORE_TESTNET.chainId }],
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [CORE_TESTNET],
                        });
                    }
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = accounts[0];

                if (CONTRACT_ADDRESS.startsWith('PASTE')) {
                    showAlert('Deploy contract first and update CONTRACT_ADDRESS!', 'error');
                    return;
                }

                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                document.getElementById('networkStatus').textContent = 'üü¢ Core Testnet';
                document.getElementById('walletAddress').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                document.getElementById('connectBtn').textContent = 'Connected';
                document.getElementById('createBtn').disabled = false;

                showAlert('Connected to Core Testnet!', 'success');

                loadPendingGames();
                loadMyGames();

            } catch (error) {
                console.error('Connection error:', error);
                showAlert('Failed to connect: ' + error.message, 'error');
            }
        }

        // ============ GAME FUNCTIONS ============
        
        async function createGame() {
            if (!contract) return;

            const stake = document.getElementById('stakeAmount').value;
            
            if (!stake || parseFloat(stake) < 0.01) {
                showAlert('Minimum stake is 0.01 CORE', 'error');
                return;
            }

            try {
                showAlert('Creating game...', 'info');

                const tx = await contract.createGame({
                    value: ethers.utils.parseEther(stake)
                });

                showAlert('Transaction submitted...', 'info');
                const receipt = await tx.wait();
                
                const gameId = receipt.events[0].args.gameId.toString();
                showAlert(`Game #${gameId} created!`, 'success');

                setTimeout(() => {
                    loadPendingGames();
                    loadMyGames();
                }, 2000);

            } catch (error) {
                console.error(error);
                showAlert('Failed to create game: ' + error.message, 'error');
            }
        }

        async function joinGame(gameId, stake) {
            if (!contract) return;

            try {
                showAlert('Joining game...', 'info');

                const tx = await contract.joinGame(gameId, {
                    value: ethers.utils.parseEther(stake)
                });

                showAlert('Transaction submitted...', 'info');
                await tx.wait();

                showAlert('Joined game!', 'success');
                currentGameId = gameId;

                setTimeout(() => {
                    loadPendingGames();
                    loadMyGames();
                    loadGame(gameId);
                }, 2000);

            } catch (error) {
                console.error(error);
                showAlert('Failed to join: ' + error.message, 'error');
            }
        }

        async function loadGame(gameId) {
            if (!contract) return;

            try {
                const game = await contract.getGame(gameId);
                renderBoard(game.board, gameId, game);
            } catch (error) {
                console.error(error);
            }
        }

        function renderBoard(board, gameId, game) {
            const container = document.getElementById('chessBoardContainer');
            const boardHTML = '<div class="chess-board">' + 
                Array.from({ length: 64 }, (_, i) => {
                    const row = Math.floor(i / 8);
                    const col = i % 8;
                    const isLight = (row + col) % 2 === 0;
                    const piece = PIECE_SYMBOLS[board[i]];
                    
                    return `<div class="chess-square ${isLight ? 'light' : 'dark'}" 
                                 onclick="selectSquare(${i}, ${gameId})"
                                 data-square="${i}">
                                ${piece}
                            </div>`;
                }).join('') + 
            '</div>';
            
            const info = `
                <div style="margin-top: 20px; text-align: center;">
                    <div>Game #${gameId}</div>
                    <div style="margin-top: 10px;">
                        ${game.currentTurn === userAddress ? 
                            '<span style="color: var(--success);">Your Turn</span>' : 
                            '<span style="color: var(--text-dim);">Opponent\'s Turn</span>'}
                    </div>
                </div>
            `;
            
            container.innerHTML = boardHTML + info;
        }

        async function selectSquare(square, gameId) {
            if (selectedSquare === null) {
                selectedSquare = square;
                document.querySelectorAll('.chess-square')[square].classList.add('selected');
            } else {
                if (selectedSquare === square) {
                    document.querySelectorAll('.chess-square')[square].classList.remove('selected');
                    selectedSquare = null;
                } else {
                    await makeMove(gameId, selectedSquare, square);
                    document.querySelectorAll('.chess-square').forEach(sq => sq.classList.remove('selected'));
                    selectedSquare = null;
                }
            }
        }

        async function makeMove(gameId, from, to) {
            if (!contract) return;

            try {
                showAlert('Making move...', 'info');

                const tx = await contract.makeMove(gameId, from, to);
                showAlert('Transaction submitted...', 'info');
                await tx.wait();

                showAlert('Move made!', 'success');
                
                setTimeout(() => loadGame(gameId), 2000);

            } catch (error) {
                console.error(error);
                showAlert('Invalid move: ' + error.message, 'error');
            }
        }

        async function loadPendingGames() {
            if (!contract) return;

            try {
                const gameIds = await contract.getPendingGames(10);
                const list = document.getElementById('gamesList');
                
                if (gameIds.length === 0) {
                    list.innerHTML = '<p style="text-align:center;color:var(--text-dim);">No games available</p>';
                    return;
                }

                let html = '';
                for (const id of gameIds) {
                    const game = await contract.getGame(id);
                    const stake = ethers.utils.formatEther(game.stake);
                    
                    html += `
                        <div class="game-item">
                            <div class="game-meta">
                                <span class="game-id">Game #${id.toString()}</span>
                                <span class="game-stake">${stake} CORE</span>
                            </div>
                            <div class="game-player">
                                ${game.player1.slice(0, 10)}...
                            </div>
                            <button onclick="joinGame(${id}, '${stake}')" style="width:100%;margin-top:10px;">
                                Join Game
                            </button>
                        </div>
                    `;
                }
                
                list.innerHTML = html;

            } catch (error) {
                console.error(error);
            }
        }

        async function loadMyGames() {
            if (!contract || !userAddress) return;

            try {
                const gameIds = await contract.getPlayerGames(userAddress);
                const list = document.getElementById('myGamesList');
                
                if (gameIds.length === 0) {
                    list.innerHTML = '<p style="text-align:center;color:var(--text-dim);">No games yet</p>';
                    return;
                }

                let html = '';
                for (const id of gameIds) {
                    const game = await contract.getGame(id);
                    const stake = ethers.utils.formatEther(game.stake);
                    const status = ['Pending', 'Active', 'Completed', 'Cancelled'][game.status];
                    
                    html += `
                        <div class="game-item">
                            <div class="game-meta">
                                <span class="game-id">Game #${id.toString()}</span>
                                <span class="game-stake">${status}</span>
                            </div>
                            <div style="margin-top: 10px;">Stake: ${stake} CORE</div>
                            ${game.status === 1 ? 
                                `<button onclick="loadGame(${id})" style="width:100%;margin-top:10px;">
                                    View Game
                                </button>` : ''}
                        </div>
                    `;
                }
                
                list.innerHTML = html;

            } catch (error) {
                console.error(error);
            }
        }

        function showAlert(message, type) {
            const area = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            area.appendChild(alert);
            
            setTimeout(() => alert.remove(), 5000);
        }

        // Auto-refresh
        setInterval(() => {
            if (contract) {
                loadPendingGames();
                loadMyGames();
                if (currentGameId) loadGame(currentGameId);
            }
        }, 10000);
    </script>
</body>
</html>
